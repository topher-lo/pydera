<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.1" />
<title>getgar.dera API documentation</title>
<meta name="description" content="The `dera` module contains functions to process structured datasets
produced by the SEC&#39;s Divison of Economic and Risk Analysis …" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>getgar.dera</code></h1>
</header>
<section id="section-intro">
<p>The <code>dera</code> module contains functions to process structured datasets
produced by the SEC's Divison of Economic and Risk Analysis.</p>
<p>Supported datasets from DERA include:
- Mutual Fund Prospectus Risk / Return Summary
- Financial Statements</p>
<p>You can find DERA datasets at <a href="https://www.sec.gov/dera/data">https://www.sec.gov/dera/data</a></p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;
The `dera` module contains functions to process structured datasets
produced by the SEC&#39;s Divison of Economic and Risk Analysis.

Supported datasets from DERA include: 
    - Mutual Fund Prospectus Risk / Return Summary
    - Financial Statements

You can find DERA datasets at https://www.sec.gov/dera/data
&#34;&#34;&#34;

import sys
import os
import numpy as np
import pandas as pd 
import urllib.error as urlerr
import tempfile

import dateutil.parser

from datetime import date
from urllib import request
from typing import Union
from typing import List

from getgar.utils import unzip


def zip_to_tags(dir: str,
                start_date: str, 
                end_date: Union[None, str]=None,

) -&gt; pd.DataFrame:
    &#34;&#34;&#34;SQL FULL OUTER JOINS all TAG tables in dataset zipfiles
    between start_date and end_date.

    The TAG (Tags) table contains all standard taxonomy tags
    (as of the date) and custom tags.

    References:
    https://www.sec.gov/info/edgar/edgartaxonomies.shtml

    Args: 
        dir: str
            Path to directory containg DERA datasets as zipfiles.
    
        start_date: str
            Fetch all datasets after start_date
            (includes start_date&#39;s quarter even if start_date is after the
            start of the quarter).

            Date must be written in some ordered DateTime string format 
            e.g. DD/MM/YYYY, DD-MM-YYYY, YYYY/MM/DD, YYYY-MM-DD

        end_date: Union[None, str]
            Optional; if end_date = None, feteches all datasets 
            before today (UTC) and after start_end.
            (includes end_date&#39;s quarter even if end_date is before the
            end of the quarter).

            Date must be written in some ordered DateTime string format 
            e.g. DD/MM/YYYY, DD-MM-YYYY, YYYY/MM/DD, YYYY-MM-DD
    &#34;&#34;&#34;
    # Convert datetime string to %d-%m-$Y format
    start_date = dateutil.parser\
                         .parse(start_date)\
                         .strftime(&#39;%d-%m-%Y&#39;)
    if not(end_date):
        end_date = date.today().strftime(&#39;%d-%m-%Y&#39;)
    else:
        end_date = dateutil.parser\
                           .parse(end_date)\
                           .strftime(&#39;%d-%m-%Y&#39;)
    end_date = end_date

    # Get list of quarters between start_date and end_date
    start_end_dates = pd.to_datetime([start_date, end_date])
    date_range = pd.date_range(*(start_end_dates) + pd.offsets.QuarterEnd(), freq=&#39;Q&#39;)\
                    .to_period(&#39;Q&#39;)\
                    .strftime(&#39;%Yq%q&#39;)\
                    .to_list()
    # Create tmp dir
    with tempfile.TemporaryDirectory(dir=tempfile.gettempdir()) as tmpdir:
        # Unzip TAG tables into tmp dir
        for f in os.listdir(dir):
            path = os.path.join(dir, f)
            if any(q in path for q in date_range):
                unzip(f&#39;{path}&#39;, &#39;tag.tsv&#39;, tmpdir)
                dataset_name = f.split(&#39;.&#39;)[0]
                os.rename(f&#39;{tmpdir}/tag.tsv&#39;, 
                            f&#39;{tmpdir}/{dataset_name}_tag.tsv&#39;)
        
        # UNION all TAG tables on columns
        table_paths = [os.path.join(tmpdir, f) for f in os.listdir(tmpdir)]
        tables = [pd.read_csv(t, sep=&#39;\t&#39;)
                    .set_index([&#39;tag&#39;, &#39;version&#39;]) for t in table_paths]
        data = pd.concat(tables, axis=0)
        data = data[~data.index.duplicated(keep=&#39;first&#39;)]

        # Sort TAG tables rows by tag index
        data = data.sort_index()

    return data


def display_tags(data: pd.DataFrame, 
                 custom: bool=False, 
                 dtype: bool=False,
                 detailed: bool=False,
                 numerical: int=2
) -&gt; str:
    &#34;&#34;&#34;Returns tags stored in self.TAG as a string
    in a human readable format. 

    Args:
        dataframe(pd.DataFrame):


        custom (bool):
            Optional; 

        dtype (bool):
            Optional; 

        detailed (bool):
            Optional; 

        numerical (int):
            Optional; 

    Returns:
        Tag names and descriptions as a multi-line string.

    Raise:
        ValueError (No TAG table found) if self.TAG is empty.
    &#34;&#34;&#34;
    tags = data
    if custom:
        tags = tags[tags[&#39;custom&#39;] == 1]
    else:
        tags = tags[tags[&#39;custom&#39;] == 0]
    full_desc = &#39;&#39;
    for i in range(len(tags)):
        entry = tags.iloc[i]
        attr = (entry[&#39;tag&#39;], entry[&#39;version&#39;], entry[&#39;tlabel&#39;])
        tag_desc = f&#39;\nTag: {attr[0]} \
                        \nVersion: {attr[1]} \
                        \nLabel: {attr[2]}&#39;
        if dtype:
            attr = entry[&#39;datatype&#39;]
            tag_desc = tag_desc + f&#39;\nDatatype: {attr}&#39;
        if detailed:
            attr = entry[&#39;doc&#39;]
            tag_desc = tag_desc + f&#39;\nDefinition: {attr}&#39;
        full_desc = full_desc + tag_desc
    return full_desc

    
def zip_to_subs(self, dir: str) -&gt; pd.DataFrame:
    &#34;&#34;&#34;SQL FULL OUTER JOINS all SUB tables in dataset zipfiles
    between start_date and end_date.
    &#34;&#34;&#34;
    pass</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="getgar.dera.display_tags"><code class="name flex">
<span>def <span class="ident">display_tags</span></span>(<span>data: pandas.core.frame.DataFrame, custom: bool = False, dtype: bool = False, detailed: bool = False, numerical: int = 2) ‑> str</span>
</code></dt>
<dd>
<div class="desc"><p>Returns tags stored in self.TAG as a string
in a human readable format. </p>
<h2 id="args">Args</h2>
<p>dataframe(pd.DataFrame):</p>
<p>custom (bool):
Optional; </p>
<p>dtype (bool):
Optional; </p>
<p>detailed (bool):
Optional; </p>
<p>numerical (int):
Optional; </p>
<h2 id="returns">Returns</h2>
<p>Tag names and descriptions as a multi-line string.</p>
<h2 id="raise">Raise</h2>
<p>ValueError (No TAG table found) if self.TAG is empty.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def display_tags(data: pd.DataFrame, 
                 custom: bool=False, 
                 dtype: bool=False,
                 detailed: bool=False,
                 numerical: int=2
) -&gt; str:
    &#34;&#34;&#34;Returns tags stored in self.TAG as a string
    in a human readable format. 

    Args:
        dataframe(pd.DataFrame):


        custom (bool):
            Optional; 

        dtype (bool):
            Optional; 

        detailed (bool):
            Optional; 

        numerical (int):
            Optional; 

    Returns:
        Tag names and descriptions as a multi-line string.

    Raise:
        ValueError (No TAG table found) if self.TAG is empty.
    &#34;&#34;&#34;
    tags = data
    if custom:
        tags = tags[tags[&#39;custom&#39;] == 1]
    else:
        tags = tags[tags[&#39;custom&#39;] == 0]
    full_desc = &#39;&#39;
    for i in range(len(tags)):
        entry = tags.iloc[i]
        attr = (entry[&#39;tag&#39;], entry[&#39;version&#39;], entry[&#39;tlabel&#39;])
        tag_desc = f&#39;\nTag: {attr[0]} \
                        \nVersion: {attr[1]} \
                        \nLabel: {attr[2]}&#39;
        if dtype:
            attr = entry[&#39;datatype&#39;]
            tag_desc = tag_desc + f&#39;\nDatatype: {attr}&#39;
        if detailed:
            attr = entry[&#39;doc&#39;]
            tag_desc = tag_desc + f&#39;\nDefinition: {attr}&#39;
        full_desc = full_desc + tag_desc
    return full_desc</code></pre>
</details>
</dd>
<dt id="getgar.dera.zip_to_subs"><code class="name flex">
<span>def <span class="ident">zip_to_subs</span></span>(<span>self, dir: str) ‑> pandas.core.frame.DataFrame</span>
</code></dt>
<dd>
<div class="desc"><p>SQL FULL OUTER JOINS all SUB tables in dataset zipfiles
between start_date and end_date.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def zip_to_subs(self, dir: str) -&gt; pd.DataFrame:
    &#34;&#34;&#34;SQL FULL OUTER JOINS all SUB tables in dataset zipfiles
    between start_date and end_date.
    &#34;&#34;&#34;
    pass</code></pre>
</details>
</dd>
<dt id="getgar.dera.zip_to_tags"><code class="name flex">
<span>def <span class="ident">zip_to_tags</span></span>(<span>dir: str, start_date: str, end_date: Union[NoneType, str] = None) ‑> pandas.core.frame.DataFrame</span>
</code></dt>
<dd>
<div class="desc"><p>SQL FULL OUTER JOINS all TAG tables in dataset zipfiles
between start_date and end_date.</p>
<p>The TAG (Tags) table contains all standard taxonomy tags
(as of the date) and custom tags.</p>
<p>References:
<a href="https://www.sec.gov/info/edgar/edgartaxonomies.shtml">https://www.sec.gov/info/edgar/edgartaxonomies.shtml</a></p>
<p>Args:
dir: str
Path to directory containg DERA datasets as zipfiles.</p>
<pre><code>start_date: str
    Fetch all datasets after start_date
    (includes start_date's quarter even if start_date is after the
    start of the quarter).

    Date must be written in some ordered DateTime string format 
    e.g. DD/MM/YYYY, DD-MM-YYYY, YYYY/MM/DD, YYYY-MM-DD

end_date: Union[None, str]
    Optional; if end_date = None, feteches all datasets 
    before today (UTC) and after start_end.
    (includes end_date's quarter even if end_date is before the
    end of the quarter).

    Date must be written in some ordered DateTime string format 
    e.g. DD/MM/YYYY, DD-MM-YYYY, YYYY/MM/DD, YYYY-MM-DD
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def zip_to_tags(dir: str,
                start_date: str, 
                end_date: Union[None, str]=None,

) -&gt; pd.DataFrame:
    &#34;&#34;&#34;SQL FULL OUTER JOINS all TAG tables in dataset zipfiles
    between start_date and end_date.

    The TAG (Tags) table contains all standard taxonomy tags
    (as of the date) and custom tags.

    References:
    https://www.sec.gov/info/edgar/edgartaxonomies.shtml

    Args: 
        dir: str
            Path to directory containg DERA datasets as zipfiles.
    
        start_date: str
            Fetch all datasets after start_date
            (includes start_date&#39;s quarter even if start_date is after the
            start of the quarter).

            Date must be written in some ordered DateTime string format 
            e.g. DD/MM/YYYY, DD-MM-YYYY, YYYY/MM/DD, YYYY-MM-DD

        end_date: Union[None, str]
            Optional; if end_date = None, feteches all datasets 
            before today (UTC) and after start_end.
            (includes end_date&#39;s quarter even if end_date is before the
            end of the quarter).

            Date must be written in some ordered DateTime string format 
            e.g. DD/MM/YYYY, DD-MM-YYYY, YYYY/MM/DD, YYYY-MM-DD
    &#34;&#34;&#34;
    # Convert datetime string to %d-%m-$Y format
    start_date = dateutil.parser\
                         .parse(start_date)\
                         .strftime(&#39;%d-%m-%Y&#39;)
    if not(end_date):
        end_date = date.today().strftime(&#39;%d-%m-%Y&#39;)
    else:
        end_date = dateutil.parser\
                           .parse(end_date)\
                           .strftime(&#39;%d-%m-%Y&#39;)
    end_date = end_date

    # Get list of quarters between start_date and end_date
    start_end_dates = pd.to_datetime([start_date, end_date])
    date_range = pd.date_range(*(start_end_dates) + pd.offsets.QuarterEnd(), freq=&#39;Q&#39;)\
                    .to_period(&#39;Q&#39;)\
                    .strftime(&#39;%Yq%q&#39;)\
                    .to_list()
    # Create tmp dir
    with tempfile.TemporaryDirectory(dir=tempfile.gettempdir()) as tmpdir:
        # Unzip TAG tables into tmp dir
        for f in os.listdir(dir):
            path = os.path.join(dir, f)
            if any(q in path for q in date_range):
                unzip(f&#39;{path}&#39;, &#39;tag.tsv&#39;, tmpdir)
                dataset_name = f.split(&#39;.&#39;)[0]
                os.rename(f&#39;{tmpdir}/tag.tsv&#39;, 
                            f&#39;{tmpdir}/{dataset_name}_tag.tsv&#39;)
        
        # UNION all TAG tables on columns
        table_paths = [os.path.join(tmpdir, f) for f in os.listdir(tmpdir)]
        tables = [pd.read_csv(t, sep=&#39;\t&#39;)
                    .set_index([&#39;tag&#39;, &#39;version&#39;]) for t in table_paths]
        data = pd.concat(tables, axis=0)
        data = data[~data.index.duplicated(keep=&#39;first&#39;)]

        # Sort TAG tables rows by tag index
        data = data.sort_index()

    return data</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="getgar" href="index.html">getgar</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="getgar.dera.display_tags" href="#getgar.dera.display_tags">display_tags</a></code></li>
<li><code><a title="getgar.dera.zip_to_subs" href="#getgar.dera.zip_to_subs">zip_to_subs</a></code></li>
<li><code><a title="getgar.dera.zip_to_tags" href="#getgar.dera.zip_to_tags">zip_to_tags</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.1</a>.</p>
</footer>
</body>
</html>